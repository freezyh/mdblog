---
title: pm2日志分割
description: pm2日志分割插件pm2-logrotate
date: 2025-10-21 11:15:16
year: 2025
---

## pm2日志分割插件pm2-logrotate

```bash [先安装pm2]
npm install pm2 -g
```

```bash [安装pm2-logrotate]
pm2 install pm2-logrotate
```

```bash [卸载]
pm2 uninstall pm2-logrotate
```

```bash [查看当前pm2-logrotate配置[方法1]]
pm2 conf pm2-logrotate
```

```bash [查看当前pm2-logrotate配置[方法2],show是查看整个进程的情况]
pm2 show pm2-logrotate
```

```sh
//设置日志文件的最大大小为 10MB，也可以设置KB大小，例如pm2 set pm2-logrotate:max_size 100KB
pm2 set pm2-logrotate:max_size 10M

//保留最近的 30 个日志文件[小贴士1]
pm2 set pm2-logrotate:retain 30

//启用日志文件压缩，压缩后是.gz文件[小贴士2]
pm2 set pm2-logrotate:compress true

//设置日志文件的日期格式
pm2 set pm2-logrotate:dateFormat YYYY-MM-DD_HH-mm-ss

//设置日志轮换检查的时间间隔为 30 秒，每30秒查看日志大小是否需要分割
pm2 set pm2-logrotate:workerInterval 30

//设置日志轮换的时间间隔为每天午夜,使用的是 cron 表达式格式[小贴士3]
pm2 set pm2-logrotate:rotateInterval '0 0 * * *'
```

### Cron表达式的基本格式

```sh
* * * * * [command]
- - - - -
| | | | |
| | | | +----- 星期几 (0 - 7) (Sunday=0 or 7) //表示任务在一周中的哪一天执行。0 和 7 都表示星期天。
| | | +------- 月份 (1 - 12) //表示任务在一年中的哪个月份执行
| | +--------- 日期 (1 - 31) //表示任务在一个月中的哪一天执行
| +----------- 小时 (0 - 23) //表示任务在一天中的哪个小时执行
+------------- 分钟 (0 - 59) //表示任务在每小时的哪一分钟执行
```

### 特殊说明

- *：表示所有可能的值。例如，_ 在分钟字段表示每分钟执行一次。
- ,：表示列表值。例如，1,2,5,7 在分钟字段表示在第1、2、5和7分钟执行。
- -：表示范围值。例如，1-5 在小时字段表示从1点到5点之间的每个小时执行。
- /：表示步长值。例如，*/5 在分钟字段表示每5分钟执行一次。
- ?：表示不指定的值。只能用于日期和星期几字段，避免冲突。
- L：表示最后的值。例如，L 在日期字段表示一个月的最后一天。
- W：表示工作日（周一到周五）最近的某一天。例如，15W 在日期字段表示最接近15号的工作日。
- #：表示某个月的第几个星期几。例如，3#2 在星期几字段表示某个月的第二个星期三。

```sh
//示例
* * * * *：每分钟执行一次。
0 * * * *：每小时的第0分钟执行一次。
0 0 * * *：每天午夜执行一次。
0 0 1 * *：每月1号的午夜执行一次。
0 0 * * 0：每周日的午夜执行一次。
0 0 1 1 *：每年1月1日的午夜执行一次。
*/5 * * * *：每5分钟执行一次。
0 9-17 * * 1-5：每周一到周五的9点到17点的每个小时的第0分钟执行一次。
```
